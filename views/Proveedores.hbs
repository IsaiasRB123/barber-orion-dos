<!DOCTYPE html>
<html lang="es">

<head>
  <!-- Agrega tus etiquetas meta y enlaces CSS aquí -->
  {{> head}}
</head>

<body>
  <!-- SideBar -->
  {{> sidebar}}

  <!-- Content page-->
  <section class="full-box dashboard-contentPage">
    <!-- NavBar -->
    <nav class="full-box dashboard-Navbar">
      <ul class="full-box list-unstyled text-right">
        <li class="pull-left">
          <a href="#!" class="btn-menu-dashboard"><i class="zmdi zmdi-more-vert"></i></a>
        </li>
        <li>
          <a href="#!" class="btn-Notifications-area">
            <i class="zmdi zmdi-notifications-none"></i>
            <span class="badge">7</span>
          </a>
        </li>
        <li>
          <a href="#!" class="btn-search">
            <i class="zmdi zmdi-search"></i>
          </a>
        </li>
        <li>
          <a href="#!" class="btn-modal-help">
            <i class="zmdi zmdi-help-outline"></i>
          </a>
        </li>
      </ul>
    </nav>
    <!-- Content page -->
    <div class="container-fluid">
      <div class="page-header">
        <h1 class="text-titles">
          <svg xmlns="http://www.w3.org/2000/svg" height="32" width="40" viewBox="0 0 640 512">
            <!-- Icono SVG -->
          </svg> Proveedores
        </h1>
      </div>
    </div>
    <div class="mb-3 mt-3">
      <a class="Btn" href="/PedidosForm">Registrar
        <svg xmlns="http://www.w3.org/2000/svg" height="12" width="15" viewBox="0 0 640 512">
          <!-- Icono SVG -->
        </svg>
      </a>
      <div class="group-search">
        <svg viewBox="0 0 24 24" aria-hidden="true" class="icon">
          <!-- Icono SVG -->
        </svg>
        <input class="input-search" type="search" placeholder="Buscar" />
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col">
          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Unidades</th>
                <th>Precio unitario</th>
                <th>Precio total</th>
                <th>Id-categoriaproducto</th>
                <th>Id-producto</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="proveedor">
              <!-- Los datos de proveedores serán insertados aquí -->
            </tbody>
          </table>
          <nav aria-label="Page navigation example">
            <ul class="pagination">
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Anterior</span>
                </a>
              </li>
              <li class="page-item"><a class="page-link" href="#">1</a></li>
              <li class="page-item"><a class="page-link" href="#">2</a></li>
              <li class="page-item"><a class="page-link" href="#">3</a></li>
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Siguiente </span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </section>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.0/dist/sweetalert2.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // URL de la API
      const apiUrl = 'http://localhost:5062/api/proveedor';

      // Consultar y renderizar proveedores al cargar la página
      consultar();

      // Función para consultar la API de proveedores usando fetch
      async function consultar() {
        try {
          const response = await fetch(apiUrl);
          if (!response.ok) {
            throw new Error('Error al obtener los datos de proveedores');
          }
          const proveedores = await response.json();
          renderizarProveedores(proveedores);
        } catch (error) {
          console.error(error);
        }
      }

      // Función para renderizar los proveedores en la tabla
      function renderizarProveedores(proveedores) {
        const tbody = document.getElementById('proveedor');
        tbody.innerHTML = ''; // Limpiar el contenido anterior

        proveedores.forEach(proveedor => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${proveedor.id}</td>
            <td>${proveedor.nombre}</td>
            <td>${proveedor.unidades}</td>
            <td>${proveedor.precio_unitario.toFixed(2)}</td>
            <td>${proveedor.precio_total.toFixed(2)}</td>
            <td>${proveedor.idcategoriaproducto}</td>
            <td>${proveedor.idproducto}</td>
            <td>${proveedor.estado ? 'Completado' : 'Pendiente'}</td>
            <td>
              <a class="Btn-shadow" href="/PedidosShadow" style="margin-left: 15px; margin-bottom: 15px; float: inline-start;">
                <svg xmlns="http://www.w3.org/2000/svg" height="10" class="svgIcon" width="11.25" viewBox="0 0 576 512">
                  <path fill="#ffffff" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
                </svg>
              </a>
              <a class="Btn-delete8" onclick="eliminarProveedor(${proveedor.id})" style="margin-left: 15px; margin-bottom: 15px; float: inline-start;">
                <svg xmlns="http://www.w3.org/2000/svg" class="svgIcon" height="10" width="8.75" viewBox="0 0 448 512">
                  <path fill="#1e3050" d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 7 298.2 0 288 0H160c-10.2 0-19.4 7-24.8 17.7zM432 128H16c-8.8 0-16 7.2-16 16 0 8.8 7.2 16 16 16H32l23.2 372.9C56.5 509.7 66.5 512 76.6 512H371.4c10.2 0 20.1-2.3 21.4-5.1L416 160h16c8.8 0 16-7.2 16-16s-7.2-16-16-16zM144 448c-8.8 0-16-7.2-16-16V224c0-8.8 7.2-16 16-16s16 7.2 16 16V432c0 8.8-7.2 16-16 16zm96 0c-8.8 0-16-7.2-16-16V224c0-8.8 7.2-16 16-16s16 7.2 16 16V432c0 8.8-7.2 16-16 16zm96-16c0 8.8-7.2 16-16 16s-16-7.2-16-16V224c0-8.8 7.2-16 16-16s16 7.2 16 16V432z"/>
                </svg>
              </a>
              <a class="Btn-edit" href="/PedidosForm" style="margin-left: 15px; margin-bottom: 15px; float: inline-start;">
                <svg xmlns="http://www.w3.org/2000/svg" class="svgIcon" height="10" width="10" viewBox="0 0 512 512">
                  <path fill="#ffffff" d="M362.7 19.3c25-25 65.5-25 90.5 0l39.5 39.5c25 25 25 65.5 0 90.5L438.6 203.5l-130-130L362.7 19.3zM308.7 64l-284 284c-3.3 3.3-5.5 7.4-6.4 11.9L1.1 473.9c-2.3 11.5 7.6 21.4 19.1 19.1l113.9-17.2c4.5-.9 8.6-3.1 11.9-6.4l284-284-130-130z"/>
                </svg>
              </a>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      // Función para eliminar un proveedor
      function eliminarProveedor(id) {
        if (confirm('¿Estás seguro de que deseas eliminar este proveedor?')) {
          axios.delete(`${apiUrl}/${id}`)
            .then(response => {
              Swal.fire({
                icon: 'success',
                title: 'Proveedor eliminado',
                text: 'El proveedor ha sido eliminado con éxito'
              });
              consultar(); // Actualizar la lista de proveedores
            })
            .catch(error => {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'No se pudo eliminar el proveedor'
              });
            });
        }
      }
    });
  </script>
</body>

</html>
