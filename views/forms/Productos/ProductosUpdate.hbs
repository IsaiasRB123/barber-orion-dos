<!DOCTYPE html>
<html lang="es">

<head>
  {{> head}}
  <style>
    /* No se requieren cambios en el CSS */
    .container-form {
      max-width: auto;
      margin:  auto ;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }




  
  </style>
</head>

<body>
  <!-- Sidebar -->
  {{> sidebar}}

  <!-- Content page-->
  <section class="full-box dashboard-contentPage">
    <!-- NavBar -->
    <nav class="full-box dashboard-Navbar">
      <!-- Navbar content -->
    </nav>
    <!-- Formulario de edición de productos -->
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <section class="container-form">
            <header>Modificar Producto</header>
            <form class="form-admin" id="formularioEditarProducto">
              <input type="hidden" name="id" id="id">
              <div class="input-box">
                <label>Nombre del Producto</label>
                <input type="text" name="nombre" id="nombre">
              </div>
              <div class="input-box">
                <label>Imagen del Producto</label>
                <input type="text" name="imagen" id="imagen">
              </div>
              <div class="input-box">
                <label>Precio</label>
                <input type="number" name="precio" id="precio">
              </div>
              <div class="input-box">
                <label>Cantidad</label>
                <input type="number" name="cantidad" id="cantidad">
              </div>
              <div class="input-box">
                <label>IVA</label>
                <input type="number" name="iva" id="iva">
              </div>
              <!-- Agregado: Campo de categoría -->
              <div class="input-box">
                <label>Categoría del Producto</label>
                <input type="text" name="categoria" id="categoria">
              </div>
              <!-- Fin de agregado -->
              <div class="formulario__mensaje" id="formulario__mensaje" style="display: none;">
                <p><svg xmlns="http://www.w3.org/2000/svg" class="svgIcon-form" viewBox="0 0 512 512">
                  </svg>
                  ERROR
                </p>
              </div>
              <button type="submit">Actualizar</button>
              <a href="/ProductoAdmin">Cerrar</a>
            </form>
          </section>
        </div>
      </div>
    </div>
    <!-- Bootstrap JS, jQuery, y Popper.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
      $(document).ready(function () {
        function obtenerProducto(id) {
          $.ajax({
            url: `http://localhost:5062/api/producto/${id}`,
            type: 'GET',
            success: function (producto) {
              $('#nombre').val(producto.productos);
              $('#imagen').val(producto.imagen);
              $('#precio').val(producto.precio);
              $('#cantidad').val(producto.cantidad);
              $('#iva').val(producto.iva);
              $('#categoria').val(producto.categoria);
            },
            error: function (error) {
              console.error('Error al obtener datos del producto:', error);
            }
          });
        }

        const urlParams = new URLSearchParams(window.location.search);
        const idProducto = urlParams.get('id');

        if (!idProducto) {
          console.error('ID del producto no proporcionado en la URL');
          return;
        }

        obtenerProducto(idProducto);

        $('#formularioEditarProducto').submit(function (event) {
          event.preventDefault();
          const productoData = {
            nombre: $('#nombre').val(),
            imagen: $('#imagen').val(),
            precio: $('#precio').val(),
            cantidad: $('#cantidad').val(),
            iva: $('#iva').val(),
            categoria: $('#categoria').val()
          };

          $.ajax({
            url: `http://localhost:5062/api/producto/${id}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(productoData),
            success: function (response) {
              Swal.fire({
                title: '¡Actualizado!',
                text: 'El producto ha sido actualizado con éxito.',
                icon: 'success'
              }).then(() => {
                window.location.href = '/ProductoAdmin';
              });
            },
            error: function (error) {
              console.error('Error al actualizar producto:', error);
              $('#formulario__mensaje').css('display', 'block');
            }
          });
        });
      });
    </script>
  </section>
</body>

</html>
